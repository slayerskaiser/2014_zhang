\documentclass[../zhang_thesis.tex]{subfiles}
\begin{document}

\chapter{Filtering Results}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The study was concerned with the accuracy and speed of the nonlinear filters on estimation of the SOC $x_1$. The accuracy was measured using the mean RMSE (MRMSE). The RMSE is defined as
\begin{equation}
    \mathrm{RMSE}(kT_s) = \sqrt{ \frac{1}{N_\text{trials}} \sum_{j=1}^{N_\text{trials}} \Big( \hat{x}_1^j(kT_s) - x_1^j(kT_s) \Big)^2 },
\end{equation}
where $T_s$ is the sample period and the superscript $j$ indicates the $j$th Monte Carlo trial. This study used $N_\text{trials}=100$ Monte Carlo trials. Then, the MRMSE is the mean of the RMSE over time, giving
\begin{equation}
    \mathrm{MRMSE} = \frac{1}{N} \sum_{k=1}^N \mathrm{RMSE}(kT_s),
\end{equation}
where $N$ is the total number of times at which the filtering was performed. An additional measure of accuracy was the number of trials in which the filter estimate diverged. A divergence is considered an absolute error in teh estimated SOC greater than $0.1$~V or any failure in the filtering process, such as due to a non-invertible matrix or a non-positive definite covariance matrix. In addition, after a numerical failure for a filter in a trial, no attempt was made to keep filtering the
system, and the remainder of the SOC values are assumed to be the worst case of zero. The speed was measured using the CPU time, which is the sum of the times used by the filter program on each of the CPU cores. The use of the CPU time results in less variability between runs compared to the clock time. In addition, the time taken to read and write the data is not counted.

The accuracy and speed were compared for sampling periods of $T_s=30$, 150, and 300 seconds. Additionally, integration steps of $M=1,2,4,\dots,256$ were used for each sampling period. The divergences of the filters for the different sampling periods is shown as a function of the number of integration steps in \cref{tab:div_30,tab:div_150,tab:div_300}. The filtering times are shown in \cref{tab:time_30,tab:time_150,tab:time_300}. The MRMSE for the
filters are shown in \cref{fig:mrmse_30,fig:mrmse_150,fig:mrmse_300}. Detailed views of the MRMSE for large $M$ are shown in \cref{fig:mrmse_det_30,fig:mrmse_det_150,fig:mrmse_det_300}.

\clearpage

\begin{table}[h]
\centering
\caption{Number of divergences in 100 Monte Carlo runs for $T_s=30$~s as a function of number of integration steps $M$}
\begin{tabular}{@{}l*{9}{c}@{}}
\toprule
Filter/$M$ & 1   & 2   & 4 & 8 & 16 & 32 & 64 & 128 & 256 \\
\midrule
EKF        & 90  & 56  & 0 & 0 & 0  & 0  & 0  & 0   & 0   \\
UKF        & 100 & 100 & 0 & 0 & 0  & 0  & 0  & 2   & 15  \\
CKF        & 100 & 100 & 0 & 0 & 0  & 0  & 0  & 0   & 0   \\
SLF        & 100 & 100 & 0 & 0 & 0  & 0  & 0  & 0   & 0   \\
\bottomrule
\end{tabular}
\label{tab:div_30}
\end{table}

\begin{table}[h]
\centering
\caption{Filtering time for 100 Monte Carlo runs for $T_s=30$~s as a function of number of integration steps $M$}
\begin{tabular}{@{}lccccccccc@{}}
\toprule
Filter/$M$ & 1     & 2     & 4     & 8     & 16    & 32    & 64    & 128   & 256   \\ \midrule
EKF        & 5.655 & 5.568 & 5.753 & 11.23 & 22.43 & 44.27 & 87.85 & 174.0 & 356.0 \\
UKF        & 6.116 & 14.49 & 39.79 & 79.01 & 157.7 & 314.8 & 626.8 & 1237  & 2297  \\
CKF        & 5.545 & 12.76 & 34.80 & 68.81 & 137.4 & 274.0 & 546.1 & 1091  & 2173  \\
SLF        & 5.057 & 7.585 & 19.03 & 36.91 & 74.06 & 147.0 & 293.7 & 583.2 & 1153  \\ \bottomrule
\end{tabular}
\label{tab:time_30}
\end{table}

\clearpage

\begin{figure}[p]
\centering
\input{chapter-3/figures/mrmse_30}
\caption{SOC error for $T_s=30$~s as a function of number of integration steps $M$.}
\label{fig:mrmse_30}
\end{figure}

\begin{figure}[p]
\centering
\input{chapter-3/figures/mrmse_det_30}
\caption{Detailed view of SOC error for $T_s=30$~s as a function of number of integration steps $M$.}
\label{fig:mrmse_det_30}
\end{figure}

\clearpage

\begin{table}[h]
\centering
\caption{Number of divergences in 100 Monte Carlo runs for $T_s=150$~s as a function of number of integration steps $M$}
\begin{tabular}{@{}l*{9}{c}@{}}
\toprule
Filter/$M$ & 1   & 2   & 4   & 8   & 16 & 32 & 64 & 128 & 256 \\
\midrule
EKF        & 100 & 100 & 98  & 77  & 0  & 0  & 0  & 0   & 0   \\
UKF        & 100 & 100 & 100 & 100 & 0  & 0  & 0  & 0   & 0   \\
CKF        & 100 & 100 & 100 & 100 & 0  & 0  & 0  & 0   & 0   \\
SLF        & 100 & 100 & 100 & 0   & 0  & 0  & 0  & 0   & 0   \\
\bottomrule
\end{tabular}
\label{tab:div_150}
\end{table}

\begin{table}[h]
\centering
\caption{Filtering time for 100 Monte Carlo runs for $T_s=150$~s as a function of number of integration steps $M$}
\begin{tabular}{@{}lccccccccc@{}}
\toprule
Filter/$M$ & 1      & 2     & 4     & 8     & 16    & 32    & 64    & 128   & 256   \\ \midrule
EKF        & 0.8610 & 2.494 & 7.534 & 8.623 & 4.272 & 8.454 & 17.22 & 34.41 & 68.39 \\
UKF        & 0.8559 & 1.744 & 3.616 & 11.45 & 31.48 & 62.96 & 125.4 & 251.8 & 502.8 \\
CKF        & 0.0310 & 1.621 & 3.204 & 10.11 & 28.04 & 55.88 & 112.4 & 221.2 & 437.9 \\
SLF        & 1.027  & 2.000 & 3.684 & 7.443 & 14.65 & 29.52 & 58.87 & 118.4 & 235.8 \\ \bottomrule
\end{tabular}
\label{tab:time_150}
\end{table}

\clearpage

\begin{figure}[p]
\centering
\input{chapter-3/figures/mrmse_150}
\caption{SOC error for $T_s=150$~s as a function of number of integration steps $M$.}
\label{fig:mrmse_150}
\end{figure}

\begin{figure}[p]
\centering
\input{chapter-3/figures/mrmse_det_150}
\caption{Detailed view of SOC error for $T_s=150$~s as a function of number of integration steps $M$.}
\label{fig:mrmse_det_150}
\end{figure}

\clearpage

\begin{table}[h]
\centering
\caption{Number of divergences in 100 Monte Carlo runs for $T_s=300$~s as a function of number of integration steps $M$}
\begin{tabular}{@{}l*{9}{c}@{}}
\toprule
Filter/$M$ & 1   & 2   & 4   & 8   & 16  & 32 & 64 & 128 & 256 \\
\midrule
EKF        & 100 & 100 & 100 & 100 & 68  & 0  & 0  & 0   & 0   \\
UKF        & 100 & 100 & 100 & 100 & 100 & 0  & 0  & 0   & 0   \\
CKF        & 100 & 100 & 100 & 100 & 0   & 0  & 0  & 0   & 0   \\
SLF        & 100 & 100 & 100 & 100 & 0   & 0  & 0  & 0   & 0   \\
\bottomrule
\end{tabular}
\label{tab:div_300}
\end{table}

\begin{table}[h]
\centering
\caption{Filtering time for 100 Monte Carlo runs for $T_s=300$~s as a function of number of integration steps $M$}
\begin{tabular}{@{}lccccccccc@{}}
\toprule
Filter/$M$ & 1      & 2      & 4     & 8     & 16    & 32    & 64    & 128   & 256   \\ \midrule
EKF        & 0.2470 & 0.8910 & 3.572 & 7.913 & 8.174 & 4.451 & 8.755 & 17.62 & 34.38 \\
UKF        & 0.0480 & 0.0480 & 1.543 & 3.477 & 9.372 & 31.64 & 63.17 & 125.9 & 252.0 \\
CKF        & 0.0320 & 0.0640 & 1.535 & 3.061 & 10.28 & 28.27 & 55.80 & 109.7 & 217.9 \\
SLF        & 0.4580 & 1.055  & 1.933 & 3.638 & 7.393 & 14.86 & 29.44 & 58.90 & 117.6 \\ \bottomrule
\end{tabular}
\label{tab:time_300}
\end{table}

\clearpage

\begin{figure}[p]
\centering
\input{chapter-3/figures/mrmse_300}
\caption{SOC error for $T_s=300$~s as a function of number of integration steps $M$.}
\label{fig:mrmse_300}
\end{figure}

\begin{figure}[p]
\centering
\input{chapter-3/figures/mrmse_det_300}
\caption{Detailed view of SOC error for $T_s=300$~s as a function of number of integration steps $M$.}
\label{fig:mrmse_det_300}
\end{figure}

\end{document}
